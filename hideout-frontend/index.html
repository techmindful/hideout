<html>

  <head>
    <meta charset="UTF-8">
    <title>Technical Mindfulness</title>
    <script src="/main.js"></script>
  </head>

  <body>

    <div id="elm-app"></div>
    <script>
      var elmApp = Elm.Main.init({
        node: document.getElementById("elm-app")
      })

      elmApp.ports.port_InitWs.subscribe( function( chatId )
        {
          var socket = new WebSocket( "ws://localhost:8080/chat/" + chatId );

          socket.addEventListener( "open",
            function( event )
            {
              elmApp.ports.port_WsReady.send( "wsReady" );
            }
          );

          elmApp.ports.port_SendWsMsg.subscribe( function( msg )
              {
                socket.send( msg );
              }
          );

          socket.addEventListener( "message",
            function( event )
            {
              elmApp.ports.port_RecvWsMsg.send( event.data );
            }
          );
        }
      );

      window.addEventListener( "beforeunload",
        function( event )
        {
          socket.close();
        }
      ); 
    </script>

  </body>

</html>

